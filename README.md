# Курсовая работа по курсу "Проектирование высоконагруженных систем"  
**Студент**: Фролов И.О. WEB-31 (Осень 2025)  
# CoinBase (Централизованная криптовалютная биржа)

---

## 1. Тема и целевая аудитория

**Тип сервиса**: Криптовалютная биржа и кошелек  
**Целевая аудитория**: Глобальная (США и ЕС в приоритете, за исключением стран с полным запретом криптовалюты) [1]  

- **MAU (Monthly Active Users)**: **120 миллионов** — общее число пользователей, взаимодействующих с платформой ежемесячно (просмотр курсов, портфеля, новостей) [1]  
- **MTU\* (Monthly Transacting Users)**: **8.7 миллионов** — пользователи, совершающие хотя бы одну торговую операцию в месяц (Q2 2025) [1]  
- **DAU (Daily Active Users)**: **~4.3 миллиона** — консервативная оценка, основанная на предположении, что 50% активных трейдеров (MTU) заходят ежедневно для торговли или мониторинга позиций [1]  

> **Примечание**: Coinbase перешла на отчетность по MTU как ключевой метрике активности, так как именно транзакционные пользователи генерируют основной доход. Большинство из 120M MAU — пассивные держатели или читатели контента.

**Ключевой функционал**: Торговые операции с криптовалютой (купля/продажа, обмен, вывод)  
**Ключевое продуктовое решение**: Хранение средств пользователей на кошельках платформы с внутренним matching engine для исполнения ордеров [3]

**Основной функционал MVP**:
- Регистрация и прохождение KYC-верификации (подтверждение личности) // LKS, Verify, Auth
- Пополнение/Вывод баланса фиатными валютами (USD, EUR и др.) // Кошелёк
- Покупка/продажа криптовалюты по рыночной цене (маркет-ордера с минимальной задержкой)
- Отправка/получение криптовалюты на внешние кошельки // К кошельку
- Просмотр истории транзакций, текущего баланса // К Кошельку
- Получение актуальных курсов в реальном времени (с минимальной задержкой)
- Комиссия за исполнение ордера и пополнение/вывод // Монетизация
- Монетизация по информации о сделках // !TODO
---

## 2. Расчет нагрузки

**Продуктовые метрики (на основе данных Q2 2025 и усреднённых показателей 2025 года)**:

- **Ежемесячный объем торговли (Trading Volume)**: ~$310 млрд в месяц (усреднённый показатель за 2025 год) [1]  

- **Transaction Revenue (доход от комиссий)**: **$6.71 млрд TTM** → **~$560 млн в месяц** [1]  
→ **Средняя комиссия**: **~0.18%** ($560 млн / $310 млрд)  
→ **Средний объем торговли на одного MTU**: **~$35,632 в месяц** ($310 млрд / 8.7 млн MTU) [1]  

- **Средний размер сделки**: **$115** — типичный чек для розничного трейдера на Coinbase [расчитано]  
→ **Ежемесячное количество сделок**: **~3.1 миллиарда** ($310 млрд / $100)  
*(Примечание: В архитектуре matching engine под “сделкой” может пониматься исполнение части ордера — общее число ордеров может быть меньше)*

- **Число верифицированных пользователей**: **120 миллионов** [1]  
- **Количество поддерживаемых криптоактивов для розницы**: **313** (для MVP 250+) [1]  
### Продуктовые метрики — сводная таблица

| Метрика | Значение | Комментарий / Источник |
|--------|----------|-------------------------|
| **MAU (Monthly Active Users)** | 120 млн | Все пользователи, заходящие на платформу хотя бы раз в месяц (включая пассивных) [1] |
| **MTU (Monthly Transacting Users)** | 8.7 млн | Пользователи, совершившие хотя бы 1 торговую операцию в месяц (Q2 2025) [1] |
| **DAU (Daily Active Users)** | ~4.3 млн | Оценка: 50% от MTU заходят ежедневно для торговли/мониторинга (основано на типичной активности трейдеров) [1] |
| **Средний размер хранилища на пользователя** | **~10 MB** | 8.5 MB (KYC + профиль) + 1.5 MB (200 транзакций) — хранение в объектном хранилище или СУБД |
| **Среднее количество действий на DAU в день** | | |
| — Просмотр курсов / портфеля | 20 запросов | UI-запросы к API цен и балансов |
| — Торговые операции (маркет-ордера) | 1 операция | Создание и исполнение ордеров |
| — Пополнение/вывод фиата | 0.05 операций | Через банковские шлюзы или карты |
| — Перевод криптовалюты на внешний адрес | 0.03 операций | On-chain транзакции |

### Технические метрики: Размер хранения данных (в штуках и ТБ)

| Тип данных | Кол-во записей (шт) | Средний размер на запись | Общий объем | Комментарий |
|------------|---------------------|--------------------------|-------------|-------------|
| **Пользовательские профили (KYC + данные)** | 120 млн | 8.5 MB | **~1.02 PB** | Хранение документов, фото, метаданных — долгосрочное |
| **История транзакций (200 на пользователя)** | 24 млрд | 64 байта (минимум: ID, сумма, валюта, timestamp) | **~1.5 TB** | Основной объем — метаданные, не бинарные данные |
| **Ордера (ежемесячно)** | 3.1 млрд | 256 байт (ID, цена, объем, статус, юзер ID, комиссия) | **~796 GB/мес** → **~9.55 TB/год** | Хранятся до исполнения, затем архивируются для аналитики |
| **Котировки (цены) в реальном времени** | 250 активов × 60 сек × 86400 = 1.3 млрд в день | 32 байта (валюта, цена, timestamp) | **~42 GB/день** → **~15.3 TB/год** | Только изменения цен с минимальной задержкой |
| **Логи действий пользователей (audit logs)** | 4.3 млн DAU × 21.08 операций/день = 90.8 млн/день | 512 байт | **~46.5 GB/день** → **~17 TB/год** | Для аналитики, безопасности, compliance |
| **ИТОГО (активные + архивные данные за 1 год)** | — | — | **~1.06 PB** | Основной объем — профили и KYC-данные |

### Сетевой трафик

#### Пиковое потребление в течение суток (Гбит/с)

| Тип трафика | Пиковая нагрузка (Гбит/с) | Расчёт | Комментарий |
|-------------|---------------------------|--------|-------------|
| **UI/API запросы (курсы, балансы, портфель)** | 12.8 Гбит/с | `(4.3M × 20 × 2 KB) / (86400 × 0.1)` | Пик в часы открытия рынков США/ЕС |
| **Торговые ордера (создание/исполнение)** | 0.7 Гбит/с | `(4.3M × 1 × 0.5 KB) / (86400 × 0.1)` | Пик при волатильности рынка |
| **Поток цен (WebSocket / SSE)** | 5.1 Гбит/с | `250 активов × 1 обновление/сек × 64 байта × 4.3 млн DAU` | Рассылка всем подписчикам в реальном времени |
| **Фоновые синхронизации (KYC, логи, аналитика)** | 2.0 Гбит/с | Оценка на основе ETL-процессов | Асинхронные задачи, репликация, бэкапы |
| **ИТОГО ПИКОВАЯ НАГРУЗКА** | **~20.6 Гбит/с** | — | Требуется сетевая инфраструктура с запасом — минимум 25 Гбит/с на фронтендах |

> **Формула расчета пика**:  
> `(Количество запросов в день × Размер запроса в байтах × 8) / (86400 сек × Коэффициент пиковой нагрузки)`  
> **Коэффициент пиковой нагрузки = 0.1** (пик в 10 раз выше среднего — стандарт для финансовых систем).

#### Суточный трафик (ГБ/сутки)

| Тип трафика | Суточный объем (ГБ) | Расчёт |
|-------------|---------------------|--------|
| UI/API запросы | 1660 ГБ | 4.3M × 20 × 2 KB × 8 / 8 (бит → байт) |
| Торговые ордера | 91.5 ГБ | 4.3M × 1 × 0.5 KB × 8 / 8 |
| Поток цен | 665.6 ГБ | 250 × 86400 × 64 × 4.3M / 10⁹ |
| Фоновые процессы | 260 ГБ | Оценка |
| **ИТОГО** | **~2677 ГБ/сутки** | — |

### RPS (Requests Per Second)

| Тип запроса | Средний RPS | Пиковый RPS (x10) | Расчёт | Комментарий |
|-------------|-------------|-------------------|--------|-------------|
| **Получение курсов / портфеля (GET /api/v1/prices, /balance)** | 9,954 RPS | 99,540 RPS | `(4.3M × 20) / 86400` | Основная нагрузка на API-шлюзы и кэш |
| **Создание рыночного ордера (POST /api/v1/orders)** | 498 RPS | 4,980 RPS | `(4.3M × 1) / 86400` | Нагрузка на matching engine и кошельки |
| **Пополнение/вывод фиата (POST /api/v1/fiat)** | 25 RPS | 250 RPS | `(4.3M × 0.05) / 86400` | Интеграция с банковскими API |
| **Перевод криптовалюты (POST /api/v1/transfer)** | 15 RPS | 150 RPS | `(4.3M × 0.03) / 86400` | On-chain транзакции, взаимодействие с блокчейн-нодами |
| **WebSocket подписки на цены** | 107,500 RPS | 1,075,000 RPS | `250 активов × 4.3 млн DAU` | Не HTTP-запросы, а частота рассылки сообщений сервером |
| **Аутентификация / сессии (GET /auth, POST /login)** | 5,000 RPS | 50,000 RPS | Оценка на основе DAU и частоты входа/обновления токенов | Нагрузка на сервис аутентификации и Redis |

---

## Список используемых источников

1. **Coinbase Users Statistics (2025) – Worldwide Data**  
   https://www.demandsage.com/coinbase-users-statistics/  
2. **Coinbase Q2 2025 Financial Data & Shareholder Reports**  
   https://s27.q4cdn.com/397450999/files/doc_financials/2025/q2/Q2-2025-Shareholder-Letter.pdf
3. **Example of matching engine**  
   https://github.com/enewhuis/liquibook  

> *MTU — Monthly Transacting Users (ежемесячно совершающие торговые операции)*
